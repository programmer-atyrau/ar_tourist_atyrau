# Настройка .dlb моделей для AR Tourist App

## Что такое .dlb файлы?

.dlb (Draco Binary) - это сжатый формат 3D моделей, разработанный Google. Он обеспечивает:
- **Меньший размер файлов** по сравнению с .obj
- **Встроенные текстуры** и материалы
- **Эффективное сжатие** геометрии
- **Быструю загрузку** в веб-приложениях

## Техническая реализация

В нашем приложении используется `DRACOLoader` из `three-stdlib` для загрузки .dlb файлов:

```javascript
import { DRACOLoader } from 'three-stdlib';

const loader = new DRACOLoader();
loader.load(modelPath, onLoad, onProgress, onError);
```

## Как создать .dlb файлы

### Вариант 1: Использование Blender (рекомендуется)

1. **Установите Blender** (бесплатно): https://www.blender.org/
2. **Установите плагин Draco**:
   - Скачайте плагин: https://github.com/zeux/draco
   - Установите в Blender: Edit → Preferences → Add-ons → Install
3. **Экспорт модели**:
   - File → Export → Draco (.drc)
   - Выберите папку `public/models/`
   - Переименуйте файл с расширением `.dlb`

### Вариант 2: Онлайн конвертеры

1. **Google Draco Online**: https://google.github.io/draco/
2. **Three.js Editor**: https://threejs.org/editor/
3. **Online-Convert**: https://www.online-convert.com/

### Вариант 3: Командная строка

```bash
# Установка Draco tools
npm install -g draco3d

# Конвертация .obj в .dlb
draco_encoder -i input.obj -o output.dlb -qp 10 -qt 10
```

## Рекомендуемые настройки экспорта

### В Blender:
- **Quantization Position**: 10-14 (точность позиций)
- **Quantization Texture**: 10-12 (точность текстур)
- **Quantization Normal**: 8-10 (точность нормалей)
- **Compression Level**: 7-10 (уровень сжатия)

### В командной строке:
```bash
draco_encoder -i model.obj -o model.dlb \
  -qp 10 \        # Точность позиций
  -qt 10 \        # Точность текстур
  -qn 8 \         # Точность нормалей
  -cl 7           # Уровень сжатия
```

## Тестовые .dlb модели

Для демонстрации функциональности создайте следующие файлы:

### 1. bayterek.dlb
- **Описание**: Монумент Байтерек
- **Размер**: Рекомендуется до 2MB
- **Полигоны**: До 50,000

### 2. khan_shatyr.dlb
- **Описание**: ТРЦ Хан Шатыр
- **Размер**: Рекомендуется до 3MB
- **Полигоны**: До 75,000

### 3. hazret_sultan.dlb
- **Описание**: Мечеть Хазрет Султан
- **Размер**: Рекомендуется до 2MB
- **Полигоны**: До 50,000

## Проверка качества

### Визуальная проверка:
1. Загрузите .dlb файл в Three.js Editor
2. Проверьте качество геометрии
3. Убедитесь, что текстуры отображаются корректно

### Техническая проверка:
1. Размер файла должен быть меньше исходного .obj
2. Количество полигонов должно сохраниться
3. Текстуры должны быть встроены

## Оптимизация для веба

### Геометрия:
- Удалите скрытые полигоны
- Объедините близкие вершины
- Оптимизируйте UV развертку

### Текстуры:
- Сожмите до 1024x1024 или 2048x2048
- Используйте формат WebP или сжатый PNG
- Примените мипмапы

### Материалы:
- Упростите шейдеры
- Используйте PBR материалы
- Оптимизируйте нормальные карты

## Устранение проблем

### Ошибка загрузки:
```javascript
// Проверьте консоль браузера
console.error('Ошибка загрузки .dlb модели:', error);
```

### Модель не отображается:
1. Проверьте путь к файлу
2. Убедитесь, что файл не поврежден
3. Проверьте размер файла (не должен быть 0 байт)

### Плохое качество:
1. Увеличьте точность квантования
2. Уменьшите уровень сжатия
3. Проверьте исходную модель

## Альтернативные форматы

Если .dlb не подходит, рассмотрите:

### .glb/.gltf
- **Преимущества**: Стандарт веб-3D, анимации
- **Недостатки**: Больший размер файлов

### .obj (сжатый)
- **Преимущества**: Простота, совместимость
- **Недостатки**: Больший размер, отдельные текстуры

### .drc (Draco)
- **Преимущества**: Максимальное сжатие
- **Недостатки**: Меньше поддержки в Three.js

## Полезные инструменты

### 3D редакторы:
- **Blender** (бесплатно)
- **Maya** (платно)
- **3ds Max** (платно)

### Конвертеры:
- **Draco tools** (npm)
- **MeshLab** (бесплатно)
- **Online конвертеры**

### Оптимизаторы:
- **Simplygon** (платно)
- **LOD Studio** (платно)
- **Blender** (встроенные инструменты)

## Заключение

.dlb формат отлично подходит для веб-приложений благодаря:
- Малому размеру файлов
- Встроенным текстурам
- Быстрой загрузке
- Хорошему качеству

Используйте рекомендованные настройки экспорта для достижения оптимального баланса между качеством и размером файла.
